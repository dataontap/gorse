<!DOCTYPE html>
<html>
<head>
    <title>dot eSIM</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">

    <!-- Firebase v8 SDK (Backward Compatible) - Load only once -->
    <script>
      // Prevent duplicate Firebase SDK loading
      if (!window.firebaseSDKLoaded) {
        window.firebaseSDKLoaded = true;
        document.write('<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"><\/script>');
        document.write('<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"><\/script>');
        document.write('<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"><\/script>');
      }
    </script>

    <!-- Firebase Configuration Scripts - Load only once -->
    <script>
      // Prevent duplicate script loading
      if (!window.configScriptsLoaded) {
        window.configScriptsLoaded = true;
        window.CURRENT_KEY = "{{ current_key }}";
        window.FIREBASE_API_KEY = "{{ firebase_api_key }}";
        
        // Load Firebase config scripts only once
        var initScript = document.createElement('script');
        initScript.src = '/static/firebase-init.js';
        initScript.onload = function() {
          var authScript = document.createElement('script');
          authScript.src = '/static/firebase-auth.js';
          document.head.appendChild(authScript);
        };
        document.head.appendChild(initScript);
        
        // Register service worker only once
        if ('serviceWorker' in navigator && !window.serviceWorkerRegistered) {
          window.serviceWorkerRegistered = true;
          navigator.serviceWorker.register('/firebase-messaging-sw.js')
            .then(function(registration) {
              // Pass API key to service worker
              if (registration.active) {
                registration.active.postMessage({
                  type: 'FIREBASE_CONFIG',
                  apiKey: "{{ firebase_api_key }}"
                });
              }
            });
        }
      }
    </script>

    </head>
<body class="landing-page">
    <div class="hero-container">
        <div class="hero-image"></div>
        <div class="promo-text">
            GLOBAL<br>
            infinitely<br>
            shareable<br>
            fast 5G+<br>
            no-expiry<br>
            mobile<br>
            DATA
        </div>
        <div class="content-overlay">
            <div class="cta-container">
                <a href="/signup" class="btn btn-primary btn-lg signup-btn">CONNECT in &lt;1 MIN</a>
                <p class="signin-text">
                    <a href="/login" class="signin-link">Members Access</a>
                </p>
                <div class="canada-service">
                    <p style="color: white; font-size: 14px; margin: 20px 0 10px 0;">
                        Connectivity Services for Canadians Everywhere ðŸ‡¨ðŸ‡¦
                    </p>
                </div>
                <div class="demo-mode-section" style="text-align: center; margin-top: 20px;">
                    <p style="color: #cccccc; margin-bottom: 15px; font-size: 16px;">
                        Or explore without signing in:
                    </p>
                    <button onclick="enableDemoMode()" class="demo-mode-btn" style="background: rgba(116, 192, 252, 0.2); border: 1px solid #74c0fc; color: #74c0fc; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        ðŸŽ® Try Demo Mode
                    </button>
                </div>
                <div class="legal-links" style="margin-top: 30px;">
                    <a href="/privacy" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">Privacy Policy</a>
                    <a href="/terms" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">Terms of Service</a>
                    <a href="/about" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">About</a>
                    <a href="mailto:hq@dotmobile.app" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">
                        <i class="fas fa-envelope" style="margin-right: 5px;"></i>Contact Us
                    </a>
                </div>

                <div class="service-provider" style="margin-top: 30px; text-align: center; color: #CCCCFF; font-size: 11px;">
                    <p style="margin: 0; line-height: 1.4;">Service Provided by Data On Tap Inc. Licensed Full MVNO. Network 302 100.<br>Parkdale, ON, CANADA</p>
                </div>
            </div>
        </div>
    </div>


</body>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Clear any cached authentication data when visiting landing page
        localStorage.removeItem('currentUser');
        localStorage.removeItem('userId');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('databaseUserId');

        // Demo mode functions
        function enableDemoMode() {
            localStorage.setItem('demoMode', 'true');

            // Show success message
            const successMessage = document.createElement('div');
            successMessage.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(81, 207, 102, 0.2);
                border: 1px solid #51cf66;
                color: #51cf66;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 14px;
            `;
            successMessage.textContent = 'ðŸŽ® Demo Mode Activated! Redirecting to dashboard...';
            document.body.appendChild(successMessage);

            setTimeout(() => {
                if (document.body.contains(successMessage)) {
                    document.body.removeChild(successMessage);
                }
                // Redirect to dashboard in demo mode
                window.location.href = '/dashboard';
            }, 2000);
        }
    </script>
</body>
        <!-- Demo mode activation from URL -->
        <script>
            // Check if demo mode is requested via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('demo') === 'true') {
                localStorage.setItem('demoMode', 'true');
                // Remove demo parameter from URL
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }
        </script>
    <script>
        function initializeLandingPage() {
            // Simple check without creating new auth state listeners
            if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
                console.log('User is already signed in, redirecting to dashboard');
                window.location.href = '/dashboard';
            }
        }

        // Check auth state only once when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initializeLandingPage, 2000); // Wait for Firebase to load
            });
        } else {
            setTimeout(initializeLandingPage, 2000);
        }
    </script>
</html>