<!DOCTYPE html>
<html>
<head>
    <title>dot eSIM</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <script src="/static/firebase-init.js"></script>
    <script src="/static/firebase-auth.js"></script>
</head>
<body class="landing-page">
    <div class="hero-container">
        <div class="hero-image"></div>
        <div class="promo-text">
            GLOBAL<br>
            infinitely<br>
            shareable<br>
            fast 5G+<br>
            no-expiry<br>
            mobile<br>
            DATA
        </div>
        <div class="content-overlay">
            <div class="cta-container">
                <a href="/signup" class="btn btn-primary btn-lg signup-btn">Sign Up</a>
                <p class="signin-text">
                    <a href="/login" class="signin-link">Members Access</a>
                    <br>
                    <a href="#" class="forgot-password-link" onclick="showForgotPasswordModal()" style="color: #CCCCFF; font-size: 12px; text-decoration: none;">Forgot Password?</a>
                </p>
                <div class="canada-service">
                    <p style="color: white; font-size: 14px; margin: 20px 0 10px 0;">
                        PHONE/HOME/SAT service anywhere in Canada ðŸ‡¨ðŸ‡¦
                    </p>
                </div>
                <div class="legal-links" style="margin-top: 30px;">
                    <a href="/privacy" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">Privacy Policy</a>
                    <a href="/terms" style="color: #CCCCFF; font-size: 12px; margin: 0 10px; text-decoration: none;">Terms of Service</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="forgotPasswordModalLabel">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="resetEmail" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="resetEmail" required>
                            <div class="form-text">We'll send you a password reset link.</div>
                        </div>
                        <div id="resetMessage" class="alert" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="sendPasswordReset()">Send Reset Link</button>
                </div>
            </div>
        </div>
    </div>
</body>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Check if user is already logged in
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is already signed in, redirect to dashboard
                window.location.href = '/dashboard';
            }
        });

        // Show forgot password modal
        function showForgotPasswordModal() {
            const modal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
            modal.show();
        }

        // Send password reset email
        function sendPasswordReset() {
            const email = document.getElementById('resetEmail').value;
            const messageDiv = document.getElementById('resetMessage');
            
            if (!email) {
                showResetMessage('Please enter your email address.', 'danger');
                return;
            }

            // Show loading state
            const sendButton = document.querySelector('[onclick="sendPasswordReset()"]');
            const originalText = sendButton.textContent;
            sendButton.textContent = 'Sending...';
            sendButton.disabled = true;

            // Send password reset email using Firebase
            firebase.auth().sendPasswordResetEmail(email)
                .then(() => {
                    showResetMessage('Password reset link sent! Check your email.', 'success');
                    document.getElementById('resetEmail').value = '';
                    
                    // Auto-close modal after 3 seconds
                    setTimeout(() => {
                        const modal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
                        modal.hide();
                    }, 3000);
                })
                .catch((error) => {
                    console.error('Password reset error:', error);
                    let errorMessage = 'Failed to send reset email. ';
                    
                    switch (error.code) {
                        case 'auth/user-not-found':
                            errorMessage += 'No account found with this email address.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'Invalid email address.';
                            break;
                        case 'auth/too-many-requests':
                            errorMessage += 'Too many attempts. Please try again later.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    showResetMessage(errorMessage, 'danger');
                })
                .finally(() => {
                    // Restore button state
                    sendButton.textContent = originalText;
                    sendButton.disabled = false;
                });
        }

        // Show reset message in modal
        function showResetMessage(message, type) {
            const messageDiv = document.getElementById('resetMessage');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
        }

        // Handle Enter key in email input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('resetEmail').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendPasswordReset();
                }
            });
        });
    </script>
</body>
</html>